---
import { type CollectionEntry, render } from "astro:content";

import Masthead from "@/components/blog/Masthead.astro";
import TOC from "@/components/blog/TOC.astro";
import WebMentions from "@/components/blog/webmentions/index.astro";
import PostNavigation from "@/components/blog/PostNavigation.astro";
import BackToTop from "@/components/BackToTop.astro";
import { t } from "@/i18n/translations";

import BaseLayout from "./Base.astro";

interface Props {
	post: CollectionEntry<"post">;
	prevPost?: CollectionEntry<"post">;
	nextPost?: CollectionEntry<"post">;
	relatedPosts?: CollectionEntry<"post">[];
}

const { post, prevPost, nextPost, relatedPosts } = Astro.props;
const { ogImage, title, description, updatedDate, publishDate } = post.data;
const socialImage = ogImage ?? `/og-image/${post.id}.png`;
const articleDate = updatedDate?.toISOString() ?? publishDate.toISOString();
const { headings, remarkPluginFrontmatter } = await render(post);
const readingTime: number = remarkPluginFrontmatter.readingTime;
---

<BaseLayout
	meta={{
		articleDate,
		description,
		ogImage: socialImage,
		title,
	}}
>
	<article class="grow break-words" data-pagefind-body>
		<div id="blog-hero" class="mb-12"><Masthead content={post} readingTime={readingTime} /></div>
		<div class="flex flex-col gap-10 lg:flex-row lg:items-start lg:justify-between">
			{!!headings.length && <TOC headings={headings} />}
			<div
				class="prose prose-sm prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-gray-600 prose-headings:hover:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none"
			>
				<slot />
				<WebMentions />
			</div>
		</div>
		<!-- 文章导航：上一篇、下一篇、推荐文章 -->
		<PostNavigation prevPost={prevPost} nextPost={nextPost} relatedPosts={relatedPosts} />
	</article>
	<!-- 回到顶部按钮 -->
	<BackToTop targetId="blog-hero" />
</BaseLayout>
