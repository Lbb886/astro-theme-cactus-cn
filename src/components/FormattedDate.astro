---
import { getFormattedDate } from "@/utils/date";
import type { HTMLAttributes } from "astro/types";

type Props = HTMLAttributes<"time"> & {
	date: Date;
	dateTimeOptions?: Intl.DateTimeFormatOptions;
};

const { date, dateTimeOptions, ...attrs } = Astro.props;

const postDate = getFormattedDate(date, dateTimeOptions);
// 转换为上海时区的 ISO 字符串用于 datetime 属性
const shanghaiISO = new Intl.DateTimeFormat("zh-CN", {
	timeZone: "Asia/Shanghai",
	year: "numeric",
	month: "2-digit",
	day: "2-digit",
	hour: "2-digit",
	minute: "2-digit",
	second: "2-digit",
	hour12: false,
}).formatToParts(date).reduce((acc, part) => {
	if (part.type === "year") acc.year = part.value;
	if (part.type === "month") acc.month = part.value;
	if (part.type === "day") acc.day = part.value;
	if (part.type === "hour") acc.hour = part.value;
	if (part.type === "minute") acc.minute = part.value;
	if (part.type === "second") acc.second = part.value;
	return acc;
}, {} as any);

const datetime = `${shanghaiISO.year}-${shanghaiISO.month}-${shanghaiISO.day}T${shanghaiISO.hour}:${shanghaiISO.minute}:${shanghaiISO.second}+08:00`;
---

<time datetime={datetime} title={postDate} {...attrs}>{postDate}</time>
