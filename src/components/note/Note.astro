---
import { type CollectionEntry, render } from "astro:content";
import FormattedDate from "@/components/FormattedDate.astro";
import type { HTMLTag, Polymorphic } from "astro/types";

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
	note: CollectionEntry<"note">;
	isPreview?: boolean | undefined;
};

const { as: Tag = "div", note, isPreview = false } = Astro.props;
const { Content } = await render(note);
---

{isPreview ? (
	<!-- 预览模式：整个卡片可点击 -->
	<a href={`/notes/${note.id}/`} class="block group">
		<article class="relative overflow-hidden rounded-xl border border-gray-200 bg-white p-6 shadow-sm transition-all duration-300 hover:shadow-md hover:border-accent/30 dark:border-gray-700 dark:bg-gray-800/50 dark:hover:border-accent/50">
			<!-- 装饰性渐变背景 -->
			<div class="absolute inset-0 bg-gradient-to-br from-accent/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
			
			<!-- 内容区域 -->
			<div class="relative z-10">
				<!-- 标题 -->
				<Tag class="mb-3">
					<span class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-accent transition-colors duration-200">
						{note.data.title}
					</span>
				</Tag>
				
				<!-- 时间 -->
				<div class="mb-3 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
					<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
					<FormattedDate
						dateTimeOptions={{
							hour: "2-digit",
							minute: "2-digit",
							year: "numeric",
							month: "short",
							day: "numeric",
						}}
						date={note.data.publishDate}
					/>
				</div>
				
				<!-- 描述 -->
				{note.data.description && (
					<p class="text-gray-600 dark:text-gray-300 leading-relaxed">
						{note.data.description}
					</p>
				)}
				
				<!-- 阅读更多指示器 -->
				<div class="mt-4 flex items-center text-sm text-accent opacity-0 group-hover:opacity-100 transition-opacity duration-200">
					<span>阅读更多</span>
					<svg class="ml-1 h-4 w-4 transform group-hover:translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
					</svg>
				</div>
			</div>
		</article>
	</a>
) : (
	<!-- 详情模式：保持原有样式 -->
	<article data-pagefind-body={true}>
		<Tag class="title mb-4">
			{note.data.title}
		</Tag>
		
		<div class="mb-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
			<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
			</svg>
			<FormattedDate
				dateTimeOptions={{
					hour: "2-digit",
					minute: "2-digit",
					year: "numeric",
					month: "short",
					day: "numeric",
				}}
				date={note.data.publishDate}
			/>
		</div>
		
		<div class="prose prose-sm prose-cactus mt-4 max-w-none [&>p:last-of-type]:mb-0">
			<Content />
		</div>
	</article>
)}
